# Roadmap — выводим **CRM‑шаблон** в рабочий MVP

> Шаг за шагом превращаем CRM‑шаблон в готовый к подключению лидогенератор
>
> Отмечайте галочкой `[x]`, когда шаг выполнен.

---

## 0. Начальная диагностика (что уже есть)

* [x] Prisma schema → локальный Postgres (Docker)
* [x] Эндпойнты: `GET /health`, `POST /leads`
* [x] CORS для лендинга `ulpan-light.vercel.app`
* [x] Лиды сохраняются и видны в Prisma Studio

## 1. Перенос на облачную БД (Postgres на любом хостинге)

* [ ] Подготовить `schema.prisma` для продакшн-Postgres (`DATABASE_URL`)
* [ ] Настроить переменные окружения:

  * `DATABASE_URL`
  * `TG_TOKEN`, `TG_CHAT_ID`
* [ ] Выполнить миграцию: `npx prisma migrate deploy`
* [ ] Проверить таблицы и права доступа через Prisma Studio или pgAdmin

## 2. Подготовка сервера для деплоя

* [ ] Добавить в `package.json` скрипты:

  * `dev`, `start`
* [ ] Обновить `tsconfig.json` для продакшн-сборки
* [ ] Проверить отсутствие импорта Supabase SDK в ядре
- [ ] Выбрать хостинг (Railway, Hetzner, Heroku и пр.)
- [ ] Настроить CI/CD для автодеплоя на пуш в main
- [ ] Проверить /health и POST /leads на публичном URL

## 3. Интеграция форм

* [ ] Обновить `forms.js` в проекте форм:

  * `f.action = "<CRM_PUBLIC_URL>/leads"`
* [ ] Деплой проекта форм на Vercel
* [ ] Тестовый сабмит формы → лид сохраняется в CRM
- [ ] Убедиться, что лиды приходят и в Telegram, и в БД

## 4. Telegram-уведомления внутри CRM

* [ ] Оставить только SMS/Telegram внутри `/leads` маршрута
* [ ] Управление через env: `TG_TOKEN`, `TG_CHAT_ID`
* [ ] Проверить отправку сообщения при создании лида

## 5. CI/CD и деплой

* [ ] Настроить деплой на Railway / Hetzner / Heroku:

  * Авто-миграции в Postgres
  * Авто-старт сервера (`npm start`)
* [ ] Настроить мониторинг и логирование ошибок

## 6. GDPR и безопасность

* [ ] Реализовать запись согласия в `ConsentLog`
* [ ] Убедиться, что в Telegram отправляется только имя (PII минимизируется)
* [ ] Документировать права субъекта данных и процедуру удаления
- [ ] Реализовать экспорт/удаление данных по GDPR-запросу

## 7. Финальное тестирование и демо

* [ ] Smoke-тест: `GET /health` и `POST /leads`
* [ ] End-to-end: Лендинг → CRM → база → Telegram
* [ ] Подготовить демо-сценарий для клиента
- [ ] Протестировать сквозной сценарий у клиента
- [ ] Подготовить документированную демо-инструкцию
